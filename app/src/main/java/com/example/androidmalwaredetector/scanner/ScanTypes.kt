package com.example.androidmalwaredetector.scanner

import android.os.Parcelable
import kotlinx.parcelize.Parcelize

/**
 * Represents the result of a malware scan operation
 */
sealed class ScanResult {
    
    /**
     * Successful scan result with analysis details
     */
    @Parcelize
    data class Success(
        val packageName: String,
        val appName: String,
        val prediction: ThreatLevel,
        val confidence: Float,
        val sha256Hash: String? = null,
        val scanDurationMs: Long = 0,
        val features: ScanFeatures? = null,
        val isSystemApp: Boolean? = null
    ) : ScanResult(), Parcelable
    
    /**
     * Scan failed due to an error
     */
    @Parcelize
    data class Error(
        val packageName: String,
        val exception: ScanException,
        val errorCode: ErrorCode = ErrorCode.UNKNOWN
    ) : ScanResult(), Parcelable
    
    /**
     * Scan operation was cancelled
     */
    @Parcelize
    data class Cancelled(
        val packageName: String,
        val reason: String = "Scan was cancelled"
    ) : ScanResult(), Parcelable
}

/**
 * Threat level classification based on ML prediction confidence
 */
enum class ThreatLevel(val displayName: String, val description: String) {
    SAFE("Safe", "App appears to be legitimate and safe"),
    SUSPICIOUS("Suspicious", "App shows some potentially concerning behaviors"),
    MALWARE("Malware", "App is likely malicious and should be removed"),
    UNKNOWN("Unknown", "Unable to determine threat level")
}

/**
 * Error codes for scan failures
 */
enum class ErrorCode {
    PACKAGE_NOT_FOUND,
    PERMISSION_DENIED,
    MODEL_LOAD_FAILED,
    FEATURE_EXTRACTION_FAILED,
    PREDICTION_FAILED,
    UNKNOWN
}

/**
 * Contains extracted features used for ML prediction
 */
@Parcelize
data class ScanFeatures(
    val permissions: List<String>,
    val intents: List<String>,
    val featureVector: List<Float>
) : Parcelable

/**
 * Configuration for scan operations
 */
data class ScanConfig(
    val includeSystemApps: Boolean = false,
    val extractSha256: Boolean = true,
    val timeoutMs: Long = 30_000,
    val includeFeatures: Boolean = false
)

/**
 * Custom exception for scanning operations
 */
@Parcelize
data class ScanException(
    override val message: String,
    val errorCode: ErrorCode = ErrorCode.UNKNOWN,
    override val cause: Throwable? = null
) : Exception(message, cause), Parcelable

/**
 * Progress callback for batch scan operations
 */
fun interface ScanProgressCallback {
    fun onProgress(completed: Int, total: Int, currentPackage: String)
}